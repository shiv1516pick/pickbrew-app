<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PickBrew App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-black text-white">
    <div class="lg:hidden max-w-md mx-auto h-screen bg-black flex flex-col overflow-hidden">

        <div class="shrink-0 bg-[#5a7479] pt-5 pb-10">
            <div class="flex items-center gap-1.5 px-5 mb-2">
                <a href="index.html" class="text-sm opacity-70">Home</a>
                <span class="material-symbols-outlined text-[14px] opacity-50">chevron_right</span>
                <span class="text-sm font-semibold">Cart</span>
            </div>
            <h1 class="text-2xl font-semibold text-center">Cart</h1>
        </div>
        <div id="cart-area" class="bg-[#121212] rounded-t-[2.5rem] -mt-6 flex-1 overflow-y-auto">
            <div class="loader">
                <div class="loader-spinner"></div>
                <span class="loader-text">Loading cart...</span>
            </div>
        </div>
        <div id="checkout-bar" class="shrink-0 bg-[#121212] border-t border-gray-800 px-6 py-4" style="display:none;">
            <div id="loyalty-banner"
                class="flex items-center gap-3 bg-[#1e1e1e] border border-gray-700 rounded-xl px-4 py-3 mb-4">
                <span class="material-symbols-outlined text-[#af7b5c] text-[24px]">loyalty</span>
                <div class="flex-1">
                    <p class="text-xs font-semibold text-white">Join PickBrew Rewards</p>
                    <p class="text-[11px] text-gray-400">Earn points on every order</p>
                </div>
                <a href="profile.html" class="text-xs font-semibold text-[#af7b5c] whitespace-nowrap">Sign Up for
                    loyalty</a>
            </div>
            <div class="flex justify-between text-sm text-gray-400 mb-2">
                <span>Subtotal</span>
                <span id="subtotal">$0.00</span>
            </div>
            <div class="flex justify-between text-sm text-gray-400 mb-3">
                <span>Tax (8%)</span>
                <span id="tax">$0.00</span>
            </div>
            <div class="flex justify-between font-semibold mb-3">
                <span>Total</span>
                <span id="total">$0.00</span>
            </div>
            <div id="prep-estimate" class="flex items-center justify-center gap-1.5 mb-4">
                <span class="material-symbols-outlined text-[#af7b5c] text-[16px]">schedule</span>
                <span class="text-xs text-gray-300">Estimated prep: <span id="prep-time"
                        class="text-white font-semibold">~10 min</span></span>
            </div>
            <button id="checkout-btn"
                class="w-full py-3 bg-[#af7b5c] text-black text-center rounded-full font-semibold text-base mb-3">
                Checkout
            </button>
            <a href="menu.html"
                class="flex items-center justify-center gap-1.5 py-2.5 border border-gray-600 rounded-full text-sm text-gray-300 font-medium">
                <span class="material-symbols-outlined text-[18px]">add</span>
                Add More Items
            </a>
        </div>
        <div class="shrink-0 bg-black border-t border-gray-800 flex justify-around py-3">
            <a href="index.html" class="nav-item">
                <span class="material-symbols-outlined">local_cafe</span>
            </a>
            <a href="menu.html" class="nav-item">
                <span class="material-symbols-outlined">menu_book_2</span>
            </a>
            <a href="favorites.html" class="nav-item">
                <span class="material-symbols-outlined">favorite</span>
            </a>
            <a href="cart.html" class="nav-item relative">
                <span class="material-symbols-outlined">shopping_cart</span>
                <span style="display:none"
                    class="cart-badge absolute -top-1 -right-2 bg-[#441a0e] border text-xs rounded-full px-1.5 py-.75 text-white"></span>
            </a>
            <a href="profile.html" class="nav-item">
                <span class="material-symbols-outlined">account_circle</span>
            </a>
        </div>
    </div>
    <div class="hidden lg:flex min-h-screen items-center justify-center bg-black text-white">
        <p class="opacity-70">Mobile & Tablet only</p>
    </div>
    <script src="app.js"></script>
    <script src="index.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var prepTimes = {
                "brewed-coffee": "5-10 min",
                "vanilla-cold-brew": "5-8 min",
                "espresso-shot": "10-15 min",
                "americano": "5-15 min",
                "caramel-latte": "10-12 min",
                "cappuccino": "13-15 min",
                "iced-mocha": "14-16 min",
                "bagel-cream-cheese": "13-15 min",
                "butter-croissant": "12-15 min"
            };
            function getMaxPrep(cart) {
                var maxMin = 0;
                cart.forEach(function (item) {
                    var pt = prepTimes[item.id] || "5-10 min";
                    var parts = pt.replace(/[^0-9\-–]/g, "").split(/[-–]/);
                    var high = parseInt(parts[1] || parts[0]) || 10;
                    if (high > maxMin) maxMin = high;
                });
                return maxMin;
            }
            function renderCart() {
                var cart = PickBrew.getCart();
                var area = document.getElementById("cart-area");
                var checkout = document.getElementById("checkout-bar");

                if (cart.length === 0) {
                    checkout.style.display = "none";
                    area.innerHTML = '<div class="flex flex-col justify-center items-center h-full px-6">' +
                        '<span class="material-symbols-outlined text-[48px] text-gray-600 mb-3">shopping_cart</span>' +
                        '<p class="text-[#c8a27a] text-sm text-center leading-relaxed">Your cart is empty</p>' +
                        '<a href="menu.html" class="inline-block mt-4 px-6 py-2 bg-[#af7b5c] text-black text-sm font-semibold rounded-full">Browse Menu</a>' +
                        '</div>';
                    return;
                }

                checkout.style.display = "";
                var html = '<div class="px-6 pt-8 pb-4">' +
                    '<div class="flex justify-between items-center mb-5">' +
                    '<span class="text-sm text-gray-400">' + cart.length + (cart.length === 1 ? ' item' : ' items') + '</span>' +
                    '<button id="clear-cart-btn" class="flex items-center gap-1 text-xs text-red-400 font-medium">' +
                    '<span class="material-symbols-outlined text-[16px]">remove_shopping_cart</span>Clear Cart</button>' +
                    '</div>';
                cart.forEach(function (item, i) {
                    var details = [];
                    if (item.size) details.push(item.size);
                    if (item.strength) details.push(item.strength + " Strength");
                    if (item.flavor && item.flavor !== "None") details.push(item.flavor);
                    if (item.addons && item.addons.length) details.push(item.addons.join(", "));
                    var detailStr = details.join(", ");

                    html += '<div class="mb-6">' +
                        '<div class="flex gap-4">' +
                        '<img src="' + item.image + '" class="w-14 h-14 rounded-full object-cover" />' +
                        '<div class="flex-1">' +
                        '<div class="flex justify-between items-start">' +
                        '<div>' +
                        '<h3 class="font-semibold">' + item.name + '</h3>' +
                        '<p class="text-sm text-gray-400">' + detailStr + '</p>' +
                        (item.note ? '<p class="text-sm text-gray-400 mt-1"><span class="font-semibold text-gray-300">Note:</span> ' + item.note + '</p>' : '') +
                        '</div>' +
                        '<div class="flex gap-3 text-[#c8a27a]">' +
                        '<span class="material-symbols-outlined cursor-pointer text-[20px] fav-cart-btn" data-index="' + i + '">favorite</span>' +
                        '<span class="material-symbols-outlined cursor-pointer text-[20px] remove-btn" data-index="' + i + '">delete</span>' +
                        '</div></div>' +
                        '<div class="flex justify-between items-center mt-4">' +
                        '<div class="flex items-center gap-3">' +
                        '<button class="qty-dec w-7 h-7 rounded-full bg-[#af7b5c] text-black flex items-center justify-center font-bold" data-index="' + i + '">−</button>' +
                        '<span class="text-sm font-medium">' + item.qty + '</span>' +
                        '<button class="qty-inc w-7 h-7 rounded-full bg-[#af7b5c] text-black flex items-center justify-center font-bold" data-index="' + i + '">+</button>' +
                        '</div>' +
                        '<span class="font-semibold">$' + (item.price * item.qty).toFixed(2) + '</span>' +
                        '</div></div></div>' +
                        (i < cart.length - 1 ? '<hr class="border-gray-700 mt-6" />' : '') +
                        '</div>';
                });
                html += '</div>';
                area.innerHTML = html;
                var subtotal = PickBrew.getCartTotal();
                var tax = subtotal * 0.08;
                var total = subtotal + tax;
                document.getElementById("subtotal").textContent = "$" + subtotal.toFixed(2);
                document.getElementById("tax").textContent = "$" + tax.toFixed(2);
                document.getElementById("total").textContent = "$" + total.toFixed(2);
                document.getElementById("checkout-btn").textContent = "Checkout — $" + total.toFixed(2);
                var maxPrep = getMaxPrep(cart);
                document.getElementById("prep-time").textContent = "~" + maxPrep + " min";
                var loyaltyBanner = document.getElementById("loyalty-banner");
                if (PickBrew.isLoggedIn()) loyaltyBanner.style.display = "none";
                else loyaltyBanner.style.display = "";
                area.querySelectorAll(".qty-dec").forEach(function (btn) {
                    btn.addEventListener("click", function () {
                        PickBrew.updateQty(parseInt(btn.dataset.index), -1);
                        renderCart();
                    });
                });
                area.querySelectorAll(".qty-inc").forEach(function (btn) {
                    btn.addEventListener("click", function () {
                        PickBrew.updateQty(parseInt(btn.dataset.index), 1);
                        renderCart();
                    });
                });
                area.querySelectorAll(".remove-btn").forEach(function (btn) {
                    btn.addEventListener("click", function () {
                        var c = PickBrew.getCart();
                        PickBrew.showToast(c[parseInt(btn.dataset.index)].name + " removed");
                        PickBrew.removeFromCart(parseInt(btn.dataset.index));
                        renderCart();
                    });
                });
                area.querySelectorAll(".fav-cart-btn").forEach(function (btn) {
                    btn.addEventListener("click", function () {
                        var c = PickBrew.getCart();
                        var item = c[parseInt(btn.dataset.index)];
                        PickBrew.toggleFavorite({ id: item.id, name: item.name, price: item.price, image: item.image, desc: item.desc || "" });
                        PickBrew.showToast(PickBrew.isFavorite(item.id) ? "Added to favorites" : "Removed from favorites");
                    });
                });
                var clearBtn = document.getElementById("clear-cart-btn");
                if (clearBtn) {
                    clearBtn.addEventListener("click", function () {
                        localStorage.removeItem("pb_cart");
                        PickBrew.updateBadge();
                        PickBrew.showToast("Cart cleared");
                        renderCart();
                    });
                }
            }

            document.getElementById("checkout-btn").addEventListener("click", function () {
                var cart = PickBrew.getCart();
                if (cart.length === 0) return;
                window.location.href = "checkout.html";
            });

            renderCart();
        });
    </script>
</body>

</html>