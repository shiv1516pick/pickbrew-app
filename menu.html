<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PickBrew App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-black text-white">
    <div class="lg:hidden max-w-md mx-auto h-screen bg-black flex flex-col overflow-hidden">
        <div class="shrink-0 bg-[#5a7479] pt-5 pb-10">
            <div class="flex items-center gap-1.5 px-5 mb-2">
                <a href="index.html" class="text-sm opacity-70">Home</a>
                <span class="material-symbols-outlined text-[14px] opacity-50">chevron_right</span>
                <span id="breadcrumb-text" class="text-sm font-semibold">Menu</span>
            </div>
            <h1 id="page-title" class="text-2xl font-semibold text-center">Menu</h1>
        </div>
        <div class="bg-[#121212] rounded-t-[2.5rem] -mt-6 flex-1 flex flex-col overflow-hidden">
            <div class="shrink-0 px-5 pt-5 pb-3">
                <div id="cat-tabs" class="flex gap-2 overflow-x-auto"></div>
            </div>
            <div class="px-6 pb-4 flex-1 overflow-y-auto">
                <div id="menu-loader" class="loader" style="min-height:200px;">
                    <div class="loader-spinner"></div>
                    <span class="loader-text">Loading menu...</span>
                </div>
                <div id="menu-items" style="display:none;"></div>
            </div>
        </div>

        <div class="shrink-0 bg-black border-t border-gray-800 flex justify-around py-3">
            <a href="index.html" class="nav-item">
                <span class="material-symbols-outlined">local_cafe</span>
            </a>
            <a href="menu.html" class="nav-item">
                <span class="material-symbols-outlined">menu_book_2</span>
            </a>
            <a href="favorites.html" class="nav-item">
                <span class="material-symbols-outlined">favorite</span>
            </a>
            <a href="cart.html" class="nav-item relative">
                <span class="material-symbols-outlined">shopping_cart</span>
                <span style="display:none"
                    class="cart-badge absolute -top-1 -right-2 bg-[#441a0e] border text-xs rounded-full px-1.5 py-.75 text-white"></span>
            </a>
            <a href="profile.html" class="nav-item">
                <span class="material-symbols-outlined">account_circle</span>
            </a>
        </div>
    </div>
    <div class="hidden lg:flex min-h-screen items-center justify-center bg-black text-white">
        <p class="opacity-70">Mobile & Tablet only</p>
    </div>
    <script src="app.js"></script>
    <script src="index.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var categories = PickBrew.CATEGORIES;
            var products = PickBrew.PRODUCTS;
            var breadcrumb = document.getElementById("breadcrumb-text");
            var pageTitle = document.getElementById("page-title");
            var tabsContainer = document.getElementById("cat-tabs");
            var menuContainer = document.getElementById("menu-items");

            // Build category name map
            var categoryNames = { all: "Menu" };
            categories.forEach(function (c) { categoryNames[c.id] = c.name; });

            // Render tabs
            var tabHtml = '<button data-category="all" class="cat-tab shrink-0 px-4 py-1.5 rounded-full text-sm font-medium bg-[#af7b5c] text-black">All</button>';
            categories.forEach(function (c) {
                tabHtml += '<button data-category="' + c.id + '" class="cat-tab shrink-0 px-4 py-1.5 rounded-full text-sm font-medium border border-gray-600 text-gray-300">' + c.name + '</button>';
            });
            tabsContainer.innerHTML = tabHtml;

            // Render menu sections
            var sectionsHtml = "";
            categories.forEach(function (cat) {
                var catProducts = products.filter(function (p) { return p.category === cat.id; });
                if (catProducts.length === 0) return;
                sectionsHtml += '<div data-section="' + cat.id + '" class="menu-section">';
                sectionsHtml += '<h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">' + cat.name + '</h3>';
                catProducts.forEach(function (p, idx) {
                    sectionsHtml += '<div class="menu-item block mb-6" data-id="' + p.id + '" data-name="' + p.name.replace(/"/g, '&quot;') + '" data-price="' + p.price.toFixed(2) + '" data-image="' + p.image + '" data-desc="' + p.desc.replace(/"/g, '&quot;') + '">';
                    sectionsHtml += '<a href="product.html?id=' + p.id + '" class="flex gap-4">';
                    sectionsHtml += '<img src="' + p.image + '" class="w-14 h-14 rounded-full object-cover" />';
                    sectionsHtml += '<div class="flex-1">';
                    sectionsHtml += '<div class="flex justify-between items-start"><div>';
                    sectionsHtml += '<h3 class="font-semibold">' + p.name + '</h3>';
                    sectionsHtml += '<p class="text-sm text-gray-400">' + p.desc + '</p>';
                    sectionsHtml += '</div><span class="font-semibold">$' + p.price.toFixed(2) + '</span></div>';
                    sectionsHtml += '<div class="flex justify-between items-center mt-3">';
                    sectionsHtml += '<span class="text-xs text-[#c8a27a]">' + p.tag + '</span>';
                    sectionsHtml += '<div class="flex items-center gap-2">';
                    sectionsHtml += '<button class="fav-btn w-7 h-7 rounded-full bg-[#1e1e1e] border border-gray-600 flex items-center justify-center" data-id="' + p.id + '"><span class="material-symbols-outlined text-[16px]">favorite_border</span></button>';
                    sectionsHtml += '<div class="qty-controls flex items-center gap-2">';
                    sectionsHtml += '<button class="qty-dec w-7 h-7 rounded-full bg-gray-700 text-white flex items-center justify-center text-sm font-bold" style="display:none;">\u2212</button>';
                    sectionsHtml += '<span class="qty-count text-xs font-semibold min-w-[18px] text-center" style="display:none;">0</span>';
                    sectionsHtml += '<button class="qty-inc w-7 h-7 rounded-full bg-[#af7b5c] text-black flex items-center justify-center"><span class="material-symbols-outlined text-[18px]">add</span></button>';
                    sectionsHtml += '</div></div></div></div></a>';
                    if (idx < catProducts.length - 1) {
                        sectionsHtml += '<hr class="border-gray-700 mt-6" />';
                    }
                    sectionsHtml += '</div>';
                });
                sectionsHtml += '</div>';
            });
            menuContainer.innerHTML = sectionsHtml;

            // Tab switching
            var tabs = tabsContainer.querySelectorAll(".cat-tab");
            var sections = menuContainer.querySelectorAll(".menu-section");

            function setCategory(cat) {
                tabs.forEach(function (t) {
                    t.className = t.getAttribute("data-category") === cat
                        ? "cat-tab shrink-0 px-4 py-1.5 rounded-full text-sm font-medium bg-[#af7b5c] text-black"
                        : "cat-tab shrink-0 px-4 py-1.5 rounded-full text-sm font-medium border border-gray-600 text-gray-300";
                });
                sections.forEach(function (s) {
                    s.style.display = (cat === "all" || s.getAttribute("data-section") === cat) ? "" : "none";
                });
                var name = categoryNames[cat] || "Menu";
                breadcrumb.textContent = name;
                pageTitle.textContent = name;
            }
            tabs.forEach(function (tab) {
                tab.addEventListener("click", function () { setCategory(tab.getAttribute("data-category")); });
            });
            var hash = window.location.hash.replace("#", "");
            if (hash && categoryNames[hash]) setCategory(hash);

            // Sync UI (qty + favs)
            function syncUI() {
                menuContainer.querySelectorAll(".menu-item").forEach(function (item) {
                    var id = item.dataset.id;
                    var qty = PickBrew.getCartQtyById(id);
                    var dec = item.querySelector(".qty-dec");
                    var count = item.querySelector(".qty-count");
                    if (qty > 0) {
                        dec.style.display = "flex";
                        count.style.display = "";
                        count.textContent = qty;
                    } else {
                        dec.style.display = "none";
                        count.style.display = "none";
                        count.textContent = "0";
                    }
                    var favBtn = item.querySelector(".fav-btn");
                    var favIcon = favBtn.querySelector("span");
                    if (PickBrew.isFavorite(id)) {
                        favIcon.textContent = "favorite";
                        favIcon.style.color = "#ef4444";
                        favBtn.style.borderColor = "#ef4444";
                        favBtn.style.backgroundColor = "rgba(239,68,68,0.15)";
                    } else {
                        favIcon.textContent = "favorite_border";
                        favIcon.style.color = "#9ca3af";
                        favBtn.style.borderColor = "#4b5563";
                        favBtn.style.backgroundColor = "#1e1e1e";
                    }
                });
            }

            // Event delegation for qty and fav buttons
            menuContainer.addEventListener("click", function (e) {
                var incBtn = e.target.closest(".qty-inc");
                var decBtn = e.target.closest(".qty-dec");
                var favBtn = e.target.closest(".fav-btn");

                if (incBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    var item = incBtn.closest(".menu-item");
                    PickBrew.quickAdd(item.dataset.id, item.dataset.name, parseFloat(item.dataset.price), item.dataset.image, item.dataset.desc);
                    syncUI();
                } else if (decBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    var item2 = decBtn.closest(".menu-item");
                    PickBrew.quickRemove(item2.dataset.id);
                    syncUI();
                } else if (favBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    var item3 = favBtn.closest(".menu-item");
                    PickBrew.toggleFavorite({
                        id: item3.dataset.id,
                        name: item3.dataset.name,
                        price: parseFloat(item3.dataset.price),
                        image: item3.dataset.image,
                        desc: item3.dataset.desc
                    });
                    PickBrew.showToast(PickBrew.isFavorite(item3.dataset.id) ? "Added to favorites" : "Removed from favorites");
                    syncUI();
                }
            });

            syncUI();
            document.getElementById("menu-loader").style.display = "none";
            menuContainer.style.display = "";
        });
    </script>
</body>

</html>
